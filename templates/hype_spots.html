<!DOCTYPE html>
<html>
<head>
    <title>Hype Spots</title>

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin:0;
            background: linear-gradient(135deg,#1e3c72,#2a5298);
            min-height:100vh;
        }

        .hero {
            background: linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),
            url("https://images.pexels.com/photos/457882/pexels-photo-457882.jpeg");
            background-size:cover;
            background-position:center;
            padding:70px;
            color:white;
            text-align:center;
        }

        .hero h1 { font-size:40px; margin-bottom:10px; }
        .hero p { opacity:.9; font-size:18px; }

        .container {
            padding:40px;
            max-width:1000px;
            margin:auto;
        }

        .spot {
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.15);
            padding:15px;
            margin:12px 0;
            border-radius:12px;
            color:white;
            border:1px solid rgba(255,255,255,0.2);
            transition:.3s;
        }

        .spot:hover {
            transform:scale(1.02);
            background: rgba(255,255,255,0.25);
        }

        #transport {
            display:none;
            margin-top:40px;
            backdrop-filter: blur(15px);
            background: rgba(255,255,255,0.15);
            padding:25px;
            border-radius:15px;
            border:1px solid rgba(255,255,255,0.3);
            color:white;
        }

        .distance-badge {
            background: rgba(255,255,255,0.2);
            padding:8px 14px;
            border-radius:30px;
            display:inline-block;
            margin-bottom:20px;
            font-weight:bold;
        }

        .cabs {
            display:grid;
            grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
            gap:20px;
        }

        .cab-card {
            backdrop-filter: blur(12px);
            background: rgba(255,255,255,0.2);
            padding:18px;
            border-radius:15px;
            border:1px solid rgba(255,255,255,0.3);
            cursor:pointer;
            transition:.3s;
        }

        .cab-card:hover { transform: scale(1.05); }

        .cab-card.active {
            border:2px solid #ffd700;
            box-shadow:0 0 20px rgba(255,215,0,.8);
        }

        button {
            margin-top:25px;
            padding:12px 30px;
            background: linear-gradient(45deg,#ff512f,#dd2476);
            border:none;
            border-radius:30px;
            color:white;
            font-size:16px;
            cursor:pointer;
            transition:.3s;
        }

        button:hover {
            transform:scale(1.08);
            box-shadow:0 0 20px rgba(255,0,120,.6);
        }

        footer {
            margin-top:60px;
            padding:20px;
            text-align:center;
            color:white;
            background:rgba(0,0,0,0.4);
            backdrop-filter: blur(8px);
        }
    </style>
</head>

<body>

<div class="hero">
    <h1>üî• Hype Spots in {{ destination_name }}</h1>
    <p>Select places you want to explore</p>
</div>

<div class="container">

    {% for s in spots %}
    <div class="spot">
        <label>
            <input type="checkbox" class="spot-check" value="{{ s.id }}">
            <strong>{{ s.spot_name }}</strong>
        </label>
    </div>
    {% endfor %}

   <form method="POST"
      action="{{ url_for('book_cab', hotel_booking_id=hotel_booking_id) }}"
      id="cabForm">
        <div id="transport">
            <h2>üöï Select Transportation</h2>
            <div id="distanceInfo" class="distance-badge"></div>
            <div id="cabList" class="cabs"></div>

            <input type="hidden" name="cab_id" id="cab_id">
            <div id="selectedSpotsContainer"></div>

            <button type="submit">
                üöï Book Cab
            </button>
        </div>
    </form>

    <div style="margin-top:50px;text-align:center;">
        <a href="/my-bookings" style="color:white;font-size:18px;text-decoration:none;">
            ‚úÖ Finish Trip & View Booking
        </a>
    </div>

</div>

<footer>
    ¬© 2026 TripMoree ‚Ä¢ Travel Smart ‚Ä¢ Explore More ‚úàÔ∏è
</footer>
<script>
document.addEventListener("DOMContentLoaded", function () {

    const transportDiv = document.getElementById("transport");
    const cabList = document.getElementById("cabList");
    const distanceInfo = document.getElementById("distanceInfo");
    const cabInput = document.getElementById("cab_id");
    const spotsContainer = document.getElementById("selectedSpotsContainer");

    document.querySelectorAll(".spot-check").forEach(cb => {
        cb.addEventListener("change", updateTransport);
    });

    function updateTransport() {

        const selected = [];
        spotsContainer.innerHTML = "";

        document.querySelectorAll(".spot-check:checked").forEach(cb => {
            selected.push(cb.value);

            const hidden = document.createElement("input");
            hidden.type = "hidden";
            hidden.name = "spot_ids";
            hidden.value = cb.value;
            spotsContainer.appendChild(hidden);
        });

        if (selected.length === 0) {
            transportDiv.style.display = "none";
            return;
        }

        transportDiv.style.display = "block";

        fetch("/api/calculate-transport", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                hotel_id: {{ hotel_id }},
                spot_ids: selected
            })
        })
        .then(response => response.json())
        .then(data => {

            cabList.innerHTML = "";

            if (data.length > 0) {
                distanceInfo.innerText =
                    "üìç Total Distance: " + data[0].distance + " km";
            }

            data.forEach(c => {

                const card = document.createElement("div");
                card.className = "cab-card";

                card.innerHTML = `
                    <h3>${c.vehicle}</h3>
                    <p>${c.type} ‚Ä¢ ${c.ac}</p>
                    <strong>‚Çπ ${c.price}</strong>
                `;

                card.onclick = function () {
                    document.querySelectorAll(".cab-card")
                        .forEach(x => x.classList.remove("active"));

                    card.classList.add("active");
                    cabInput.value = c.cab_id;
                };

                cabList.appendChild(card);
            });
        });
    }
});
</script>
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-success text-center">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

</body>
</html>
