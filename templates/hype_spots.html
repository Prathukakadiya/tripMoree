<!DOCTYPE html>
<html>
<head>
    <title>Hype Spots</title>

    <style>
        body {
            font-family: Arial;
            background:#f5f5f5;
            margin:0;
        }

        .hero {
            background: linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),
            url("https://images.pexels.com/photos/457882/pexels-photo-457882.jpeg");
            background-size:cover;
            padding:60px;
            color:white;
            text-align:center;
        }

        .container {
            padding:30px;
        }

        .spot {
            background:white;
            padding:15px;
            margin:10px 0;
            border-radius:8px;
            box-shadow:0 0 8px rgba(0,0,0,.1);
        }

        #transport {
            display:none;
            background:white;
            padding:20px;
            margin-top:30px;
            border-radius:10px;
            box-shadow:0 0 12px rgba(0,0,0,.15);
        }

        .distance-badge {
            background:#ffe9d6;
            padding:8px 12px;
            border-radius:20px;
            display:inline-block;
            margin-bottom:15px;
            font-weight:bold;
            color:#ff6b00;
        }

        .cabs {
            display:grid;
            grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
            gap:20px;
            margin-top:20px;
        }

        .cab-card {
            background:white;
            padding:15px;
            border-radius:12px;
            box-shadow:0 6px 20px rgba(0,0,0,.15);
            cursor:pointer;
            transform: translateY(20px);
            opacity:0;
            animation: fadeUp .4s ease forwards;
            transition:.3s;
        }

        .cab-card:hover {
            transform: scale(1.05);
        }

        .cab-card.active {
            border:2px solid #ff6b00;
            box-shadow:0 0 20px rgba(255,107,0,.6);
        }

        @keyframes fadeUp {
            to {
                transform: translateY(0);
                opacity:1;
            }
        }
    </style>
</head>

<body>

<div class="hero">
    <h1>ðŸ”¥ Hype Spots in {{ destination_name }}</h1>
    <p>Select places you want to visit</p>
</div>

<div class="container">

    <!-- SPOTS -->
    {% for s in spots %}
    <div class="spot">
        <label>
            <input type="checkbox"
                   class="spot-check"
                   data-id="{{ s.id }}">
            <strong>{{ s.spot_name }}</strong>
        </label>
    </div>
    {% endfor %}

    <!-- TRANSPORT -->
    <div id="transport">
        <h2>ðŸš• Select Transportation</h2>
        <div id="distanceInfo" class="distance-badge"></div>
        <div id="cabList" class="cabs"></div>
    </div>

</div>

<script>
/* âœ… THIS WAS MISSING â€“ ROOT FIX */
const hotel_id = {{ hotel_id }};

const transportDiv = document.getElementById("transport");
const cabList = document.getElementById("cabList");
const distanceInfo = document.getElementById("distanceInfo");

document.addEventListener("change", () => {

    const selectedSpots = [];
    document.querySelectorAll(".spot-check:checked").forEach(cb => {
        selectedSpots.push(cb.dataset.id);
    });

    if (selectedSpots.length === 0) {
        transportDiv.style.display = "none";
        cabList.innerHTML = "";
        distanceInfo.innerHTML = "";
        return;
    }

    fetch("/api/calculate-distance", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            hotel_id: hotel_id,
            spots: selectedSpots
        })
    })
    .then(res => res.json())
    .then(dist => {

        distanceInfo.innerText = `ðŸ“ Total Distance: ${dist.distance_km} km`;

        return fetch("/api/calculate-transport", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ distance: dist.distance_km })
        });
    })
    .then(res => res.json())
    .then(cars => {

        transportDiv.style.display = "block";
        cabList.innerHTML = "";

        cars.forEach((c, i) => {
            const card = document.createElement("div");
            card.className = "cab-card";
            card.style.animationDelay = `${i * 0.1}s`;

            card.innerHTML = `
                <h3>${c.vehicle}</h3>
                <p>${c.type} â€¢ ${c.ac}</p>
                <strong>â‚¹ ${c.price}</strong>
            `;

            card.onclick = () => {
                document.querySelectorAll(".cab-card")
                    .forEach(x => x.classList.remove("active"));
                card.classList.add("active");
            };

            cabList.appendChild(card);
        });
    })
    .catch(err => console.error(err));
});
</script>

</body>
</html>
