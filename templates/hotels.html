{% extends "base.html" %}

{% block title %}Hotels{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/hotels.css') }}">
{% endblock %}

{% block content %}

<div class="page-wrapper">
    <h2>Available Hotels</h2>
    <div id="hotelContainer" class="hotel-container"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

    const container = document.getElementById("hotelContainer");
    const destinationId = {{ destination.id }};
    const DEFAULT_IMAGE = "{{ url_for('static', filename='images/hotel_default.jpg') }}";

    fetch(`/api/hotels/${destinationId}`)
    .then(res => res.json())
    .then(data => {

        if (!data || data.length === 0) {
            container.innerHTML = "<p>No hotels found</p>";
            return;
        }

        container.innerHTML = "";

        data.forEach(hotel => {

            let roomHTML = hotel.rooms.map(room => `
                <p>üõè ${room.type} - ${room.available} Rooms - ‚Çπ${room.price}</p>
            `).join("");

            let amenitiesHTML = hotel.amenities.length > 0
                ? hotel.amenities.join(", ")
                : "Basic Amenities";

            const card = document.createElement("div");
            card.className = "hotel-card";

            card.innerHTML = `
                <div class="image-wrapper">
                    <img src="${DEFAULT_IMAGE}" class="hotel-img" alt="hotel image">
                </div>

                <div class="hotel-info">
                    <h3>${hotel.hotel}</h3>
                    <p>‚≠ê ${hotel.stars} Rating</p>
                    <p>üí∞ Starting From ‚Çπ${hotel.price}</p>
                    <p>üõè Total Available Rooms: ${hotel.available_rooms}</p>
                    <p>üè® ${amenitiesHTML}</p>

                    <div class="room-section">
                        ${roomHTML}
                    </div>

                    <a href="/book-hotel/${hotel.id}" class="book-btn">
                        Book Now
                    </a>
                </div>
            `;

            container.appendChild(card);
        });

    })
    .catch(err => {
        console.error(err);
        container.innerHTML = "<p>Error loading hotels</p>";
    });

});
</script>

{% endblock %}
